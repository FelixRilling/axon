var Axon=function(){"use strict";const n=n=>Array.isArray(n),t=(n,t)=>typeof n===t,e=n=>t(n,"undefined"),i=n=>!e(n),r=n=>e(n)||null===n,u=n=>Object.entries(n),o=(n,t)=>n.forEach(t),c=(n,t)=>i(n[t]),f=n=>Array.from(n),l=t=>{const e=[];o(t,t=>{n(t)?e.push(...l(t)):e.push(t)});return e},s=n=>Object.assign({},n),a=n=>new Map(u(n)),d=(n,t,e)=>n.setAttribute("x-"+t,e),h=(n,t)=>n.hasAttribute("x-"+t),m=(n,t)=>n.removeAttribute("x-"+t),p=n=>n.name.startsWith("x-"),$=n=>f(n.attributes).filter(p),v=n=>$(n).length>0,b=function(n){return $(n).map(n=>{const t=n.name.replace("x-","").split(":");return{name:t[0],opt:t[1]||!1,content:n.value}})},g=function(n,t){const e=function(n){return v(n)?new D(n,t):n.children.length>0?i(n.children):null},i=n=>l(f(n).map(e).filter(n=>null!==n));return i(n)},x=function(n){let t=n;for(;null!==t.$parent;)t=t.$parent;return t},y=function(n){return{set:(t,e,i)=>{i!==t[e]&&(t[e]=i,console.log({node:n,target:t}),n.render());return!0}}},A=function(n,t,e){n.addEventListener(t,e)},w=/^["'`].*["'`]$/,E=n=>n.substr(1,n.length-2),j=(n,t,e=!1)=>{const i=t.split(/(?:\.|\[|\])+/g).map(n=>w.test(n)?E(n):n);let u=n;let o=null;let f=null;let l=0;for(;!r(u)&&l<i.length;){if(f=i[l],!c(u,f))return null;o=u,u=u[f],l++}return e?{val:u,container:o,key:f,index:l}:u},C=(a({"===":(n,t)=>n===t,"!==":(n,t)=>n!==t,">=":(n,t)=>n>=t,"<=":(n,t)=>n<=t,">":(n,t)=>n>t,"<":(n,t)=>n<t,"&&":(n,t)=>n&&t,"||":(n,t)=>n||t}),a({"+":(n,t)=>n+t,"-":(n,t)=>n-t,"*":(n,t)=>n*t,"/":(n,t)=>n/t,"%":(n,t)=>n%t,"**":(n,t)=>n**t}),a({false:!1,true:!0,null:null,undefined:void 0,Infinity:1/0}),/^[\d.-]+$/),L=/^["'`].*["'`]$/,M=/^.+\(.*\)$/,S=a({false:!1,true:!0,null:null}),k=function(n,t){return C.test(n)?Number(n):L.test(n)?n.substr(1,n.length-2):S.has(n)?S.get(n):T(n,t).val},H=n=>new Error(`missing prop/method '${n}'`),N=n=>n.val.apply(n.node.data,n.args),O=function(n,t,e=!1){if(M.test(n)){const i=B(n,t,e),r=N(i);return{node:i.node,val:r}}return T(n,t,e)},T=function(n,t,e=!1){let i=t;for(;i&&!1!==i.$parent;){const t=j(i.data,n,!0);if(null!==t)return t.node=i,t;i=i.$parent}if(e)return!1;throw H(n)},B=function(n,t,e=!1){const r=n.match(/([\w.]+)\s*\(((?:[^()]*)*)?\s*\)/),u=i(r[2])?r[2].split(","):[],o=x(t),c=j(o.methods,r[1],!0);if(null!==c)return c.args=u.map(n=>k(n,t)),c.node=o,c;if(e)return!1;throw H(n)},I=function(n){return i(n.value)?"value":i(n.textContent)?"textContent":"innerHTML"},P=(n,t)=>t?n.removeAttribute("hidden"):n.setAttribute("hidden",!0),W=/(.+) in (.+)/,q=function(n,t){const e=t.$element,i=Boolean(O(n.content,t,!0).val);return P(e,i),i},z=a({model:{init:function(n,t){const e=t.$element,i=I(e);return A(e,"input",()=>{const r=T(n.content,t);r.container[r.key]=e[i]}),!0},render:function(n,t){const e=t.$element,i=I(e),r=T(n.content,t);return e[i]=String(r.val),!0}},bind:{render:function(n,t){return t.$element.setAttribute(n.opt,O(n.content,t).val),!0}},for:{init:function(n,t){const e=t.$element;return d(t.$element,"forbase",!0),P(e,!1),!1},render:function(n,t){const e=t.$element,i=W.exec(n.content),r=i[1],u=T(i[2],t).val,c=[];o(f(e.parentElement.children),n=>{h(n,"dyn")&&n.remove()});for(let n of u){const i=e.cloneNode(!0),u=s(t.data);let o;d(i,"dyn",!0),m(i,"forbase"),m(i,"for"),P(i,!0),u[r]=n,o=e.insertAdjacentElement("beforebegin",i),c.push(new D(o,t.$parent,u))}return t.$children=c,!0}},text:{render:function(n,t){return t.$element.textContent=String(O(n.content,t).val),!0}},html:{render:function(n,t){return t.$element.innerHTML=String(O(n.content,t).val),!0}},if:{init:q,render:q},on:{init:function(n,t){return A(t.$element,n.opt,()=>N(B(n.content,t))),!0}}}),D=class{constructor(n=null,t=null,e={},i={}){const r=e;this.directives=b(n),this.data=new Proxy(r,y(this)),this.methods=i,this.$element=n,this.$parent=t,this.$children=g(n.children,this)}run(n){const t=t=>{if(z.has(t.name)){const e=z.get(t.name);if(e[n])return e[n](t,this)}return!0};return!!this.directives.map(t).every(n=>!0===n)&&this.$children.map(t=>t.run(n))}init(){return this.run("init")}render(){return this.run("render")}};return class extends D{constructor(n={}){super(n.el,null,n.data,n.methods),this.init(),this.render()}}}();
